<!DOCTYPE html>
<meta name="robots" content="noindex">
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Battle Map</title>
  <style>
    .token {
      position: absolute;
      background-size: contain;
      border-radius: 50%;

    }

    .friendly {
      border: 2px solid lightsteelblue;
    }

    .hostile {
      border: 2px solid crimson;
    }

    .boss {
      border: 2px solid goldenrod;
    }
  </style>
</head>

<body>
  <div id="game-board">
    <img src="goblin-den.png" />
  </div>

  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script>

    const squarWidth = 42;

    const combatants = [
      {
        "name": "Belimore",
        "alignment": "friendly",
        "imgSrc": "belimore.jpg",
        "x": 382,
        "y": 47
      },
      {
        "name": "Cire",
        "alignment": "friendly",
        "imgSrc": "cire.jpg",
        "x": 350,
        "y": 81
      },
      {
        "name": "Rew",
        "alignment": "friendly",
        "imgSrc": "rew.jpg",
        "x": 295,
        "y": 171
      },
      {
        "name": "Speeder",
        "alignment": "friendly",
        "imgSrc": "speeder.jpg",
        "x": 316,
        "y": 131
      },
      {
        "name": "Sildar",
        "alignment": "friendly",
        "imgSrc": "sildar.jpg",
        "x": 256,
        "y": 301
      },
      {
        "name": "GoblinOne",
        "alignment": "hostile",
        "imgSrc": "goblin.jpg",
        "x": 154,
        "y": 142
      },
      {
        "name": "GoblinTwo",
        "alignment": "hostile",
        "imgSrc": "goblin.jpg",
        "x": 101,
        "y": 233
      },
      {
        "name": "GoblinThree",
        "alignment": "hostile",
        "imgSrc": "goblin.jpg",
        "x": 70,
        "y": 200
      },
      {
        "name": "GoblinFour",
        "alignment": "hostile",
        "imgSrc": "goblin.jpg",
        "x": 78,
        "y": 139
      },
      {
        "name": "GoblinFive",
        "alignment": "hostile",
        "imgSrc": "goblin.jpg",
        "x": 107,
        "y": 107
      },
      {
        "name": "Yeemik",
        "alignment": "boss",
        "imgSrc": "goblin.jpg",
        "x": 190,
        "y": 308
      }
    ];

    const drag = () => {

      function dragstarted(d) {
        d3.select(this).raise().style('border-width', `${4}px`);
      }

      function dragged(d) {
        d3.select(this)
          .style("left", (d.x = d3.event.x) + 'px')
          .style("top", (d.y = d3.event.y) + 'px');
      }

      function dragended(d) {
        d3.select(this).style('border-width', `${2}px`);
      }

      return d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended);
    }

    const tokens = d3.select('#game-board').selectAll('.token')
      .data(combatants)
      .join('div')
      .attr('class', d => `token ${d.alignment}`)
      .style('background-image', d => `url(${d.imgSrc})`)
      .style('width', `${squarWidth}px`)
      .style('height', `${squarWidth}px`)
      .style('left', d => d.x + 'px')
      .style('top', d => d.y + 'px')
      .call(drag())

  </script>
</body>

</html>